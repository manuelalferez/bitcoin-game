<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Bitcoin Trading Game</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: #1a1a1a;
        color: #fff;
        max-width: 1000px;
        margin: 0 auto;
        padding: 20px;
      }
      #game-container,
      #welcome-screen {
        text-align: center;
        background: #242424;
        padding: 2rem;
        border-radius: 12px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }
      #bitcoin-chart {
        margin: 20px 0;
        background: #2d2d2d;
        padding: 1rem;
        border-radius: 8px;
      }
      .hidden {
        display: none;
      }
      button {
        background: #f7931a;
        color: white;
        border: none;
        padding: 12px 24px;
        margin: 8px;
        border-radius: 6px;
        cursor: pointer;
        font-weight: bold;
        transition: background 0.3s;
      }
      button:hover {
        background: #e88a16;
      }
      button:disabled {
        background: #666;
        cursor: not-allowed;
      }
      input {
        padding: 12px;
        border-radius: 6px;
        border: 1px solid #444;
        background: #333;
        color: white;
        margin: 10px 0;
        width: 200px;
      }
      .price-display {
        font-size: 2.5rem;
        font-weight: bold;
        color: #f7931a;
        margin: 1rem 0;
        text-align: center;
      }
      .balance-display {
        background: linear-gradient(145deg, #2d2d2d, #262626);
        padding: 1rem;
        border-radius: 8px;
        margin: 1rem 0;
        text-align: center;
      }
      .trading-controls {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 2rem;
        margin: 1rem 0;
      }
      .trading-section {
        background: #2d2d2d;
        padding: 0.75rem;
        border-radius: 8px;
        flex: 1;
        min-width: 200px;
      }
      .price-holdings-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 2rem;
      }
      .price-holdings-container .balance-display {
        flex: 1;
        min-width: 300px;
      }
      .holdings-details {
        display: flex;
        flex-direction: column;
        gap: 1rem;
        margin-top: 1rem;
      }
      .holdings-item {
        background: #1a1a1a;
        padding: 1rem;
        border-radius: 8px;
        border-left: 3px solid #f7931a;
      }
      .holdings-item h4 {
        color: #aaa;
        font-size: 0.9rem;
        margin: 0 0 0.5rem 0;
      }
      .holdings-item .value {
        font-size: 1.5rem;
        font-weight: bold;
        color: #f7931a;
      }
      .holdings-item.profit {
        border-left-color: #00ff00;
      }
      .holdings-item.loss {
        border-left-color: #ff0000;
      }
      .holdings-item.profit .value {
        color: #00ff00;
      }
      .holdings-item.loss .value {
        color: #ff0000;
      }
      .fa-icon {
        margin-right: 8px;
      }
      .progress-container {
        background: #2d2d2d;
        border-radius: 8px;
        padding: 1rem;
        margin: 1rem 0;
      }
      .progress-bar {
        width: 100%;
        height: 24px;
        background: #333;
        border-radius: 12px;
        overflow: hidden;
      }
      .progress-fill {
        height: 100%;
        background: #f7931a;
        transition: width 0.3s ease;
      }
      .progress-text {
        margin-top: 0.5rem;
        font-size: 1.2rem;
        color: #888;
      }
      .player-avatar {
        width: 120px;
        height: 120px;
        border-radius: 50%;
        margin: 20px auto 10px;
        border: 4px solid #f7931a;
        box-shadow: 0 4px 8px rgba(247, 147, 26, 0.3);
      }
      .player-name {
        font-size: 1.8rem;
        font-weight: bold;
        color: #f7931a;
        margin: 10px 0 20px;
      }
      .welcome-header {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 1rem;
      }
      .history-container {
        background: #2d2d2d;
        border-radius: 8px;
        padding: 1rem;
        margin: 1rem 0;
        overflow-x: auto;
      }
      .history-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 1rem;
        min-width: 600px;
      }
      .history-table th,
      .history-table td {
        padding: 12px;
        text-align: left;
        border-bottom: 1px solid #444;
      }
      .history-table th {
        background: #1a1a1a;
        color: #f7931a;
      }
      .history-table tr:hover {
        background: rgba(247, 147, 26, 0.05);
      }
      .gain-positive {
        color: #00ff00;
      }
      .gain-negative {
        color: #ff0000;
      }
      .holdings-details {
        background: rgba(247, 147, 26, 0.1);
        padding: 12px;
        border-radius: 8px;
        margin-top: 10px;
      }
      .holdings-box {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }
      .holdings-value,
      .holdings-gain {
        background: #242424;
        padding: 8px;
        border-radius: 8px;
      }
      .holdings-value h4,
      .holdings-gain h4 {
        font-size: 2.4rem;
        color: #aaa;
        margin: 0 0 6px 0;
      }
      .holdings-value div,
      .holdings-gain div {
        font-size: 1.2rem;
        font-weight: bold;
        color: #f7931a;
      }
      .fa-icon {
        margin-right: 8px;
        color: #f7931a;
      }
      .gain-loss.positive {
        color: #00ff00;
      }
      .gain-loss.negative {
        color: #ff0000;
      }
      .buy-buttons-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 10px;
        margin-top: 10px;
      }
      .buy-button,
      #sell-bitcoin {
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 10px !important;
      }
      .buy-button .percentage,
      #sell-bitcoin .percentage {
        font-size: 1.2rem;
        margin-bottom: 5px;
      }
      .buy-button .amount,
      #sell-bitcoin .amount {
        font-size: 0.9rem;
        opacity: 0.8;
      }
      #start-over-btn {
        background: #ff4444;
        margin-top: 20px;
        width: 100%;
        max-width: 300px;
      }
      #start-over-btn:hover {
        background: #cc3333;
      }

      /* Modal styles */
      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.85);
        z-index: 1000;
        justify-content: center;
        align-items: center;
      }

      .modal-content {
        background: linear-gradient(145deg, #2d2d2d, #262626);
        padding: 2rem;
        border-radius: 12px;
        max-width: 500px;
        width: 90%;
        text-align: center;
        position: relative;
        animation: modalSlideIn 0.3s ease;
        border: 1px solid rgba(247, 147, 26, 0.15);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      }

      @keyframes modalSlideIn {
        from {
          transform: translateY(-100px);
          opacity: 0;
        }
        to {
          transform: translateY(0);
          opacity: 1;
        }
      }

      .modal h2 {
        color: #f7931a;
        margin-bottom: 1.5rem;
        font-size: 1.8rem;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
      }

      .modal p {
        margin-bottom: 2rem;
        color: #fff;
        font-size: 1.1rem;
        line-height: 1.5;
      }

      .modal button {
        min-width: 120px;
        padding: 12px 24px;
        margin: 10px;
        font-size: 1rem;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
      }

      .modal button.cancel-btn {
        background: #444;
      }

      .modal button.cancel-btn:hover {
        background: #555;
      }

      .modal button.confirm-btn {
        background: #ff4444;
      }

      .modal button.confirm-btn:hover {
        background: #ff2222;
      }

      .modal .fa-icon {
        font-size: 1.2rem;
      }

      .social-buttons {
        display: flex;
        gap: 1rem;
        justify-content: center;
        margin-top: 1.5rem;
      }

      .social-button {
        padding: 10px 20px;
        border-radius: 6px;
        color: white;
        text-decoration: none;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .social-button.twitter {
        background: #1DA1F2;
      }

      .social-button.facebook {
        background: #4267B2;
      }

      .social-button.linkedin {
        background: #0077b5;
      }

      @media (max-width: 600px) {
        .history-container {
          margin: 1rem -20px;
          border-radius: 0;
        }
        .history-table {
          font-size: 14px;
        }
        .history-table th,
        .history-table td {
          padding: 8px;
        }
        .social-buttons {
          flex-direction: column;
        }
      }

      .input-error {
        border-color: #ff4444 !important;
        animation: shake 0.5s;
      }

      .error-message {
        color: #ff4444;
        font-size: 0.9rem;
        margin-top: 5px;
        display: none;
      }

      @keyframes shake {
        0%, 100% { transform: translateX(0); }
        25% { transform: translateX(-10px); }
        75% { transform: translateX(10px); }
      }

      .difficulty-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 24px rgba(247, 147, 26, 0.2);
      }

      /* Standard card styling */
      .balance-display,
      .trading-section,
      .progress-container,
      .history-container,
      #game-container,
      #welcome-screen {
        background: linear-gradient(145deg, #2a2a2a, #242424);
        padding: 2rem;
        border-radius: 12px;
        margin-bottom: 2rem;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        border: 1px solid rgba(247, 147, 26, 0.1);
      }

      /* Bitcoin price and holdings cards */
      .balance-display {
        background: linear-gradient(145deg, #2d2d2d, #262626);
        border: 1px solid rgba(247, 147, 26, 0.15);
        text-align: center;
      }

      /* Progress container with special styling */
      .progress-container {
        background: linear-gradient(145deg, #2c2c2c, #252525);
        border: 1px solid rgba(247, 147, 26, 0.12);
      }

      /* Trading sections with unique background */
      .trading-section {
        background: linear-gradient(145deg, #2e2e2e, #272727);
        border: 1px solid rgba(247, 147, 26, 0.1);
      }

      /* History container styling */
      .history-container {
        background: linear-gradient(145deg, #2b2b2b, #242424);
        border: 1px solid rgba(247, 147, 26, 0.08);
      }

      /* Bitcoin chart container */
      #bitcoin-chart {
        background: linear-gradient(145deg, #2f2f2f, #282828);
        border: 1px solid rgba(247, 147, 26, 0.1);
        margin-bottom: 2rem;
        padding: 1.5rem;
        border-radius: 12px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }

      /* Holdings items with hover effect */
      .holdings-item {
        background: linear-gradient(145deg, #2a2a2a, #232323);
        border-left: 3px solid #f7931a;
        transition: transform 0.2s, box-shadow 0.2s;
      }

      .holdings-item:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
      }

      /* Holdings value and gain boxes */
      .holdings-value,
      .holdings-gain {
        background: linear-gradient(145deg, #2c2c2c, #252525);
        border: 1px solid rgba(247, 147, 26, 0.1);
        transition: transform 0.2s;
      }

      .holdings-value:hover,
      .holdings-gain:hover {
        transform: translateY(-2px);
      }

      /* Difficulty cards enhanced styling */
      .difficulty-card {
        background: linear-gradient(145deg, #2d2d2d, #262626) !important;
        border: 1px solid rgba(247, 147, 26, 0.1);
        transition: transform 0.3s, box-shadow 0.3s;
      }

      .difficulty-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 24px rgba(247, 147, 26, 0.2);
        border: 1px solid rgba(247, 147, 26, 0.2);
      }

      /* Modal content styling */
      .modal-content {
        background: linear-gradient(145deg, #2d2d2d, #262626);
        border: 1px solid rgba(247, 147, 26, 0.15);
      }

      /* Achievement card styling */
      #achievement-card {
        background: linear-gradient(145deg, #2e2e2e, #272727) !important;
        border: 1px solid rgba(247, 147, 26, 0.2);
      }

      /* Header and footer consistent styling */
      header,
      footer {
        background: linear-gradient(145deg, #2d2d2d, #262626) !important;
        border: 1px solid rgba(247, 147, 26, 0.1);
      }

      /* Update the balance-display container */
      .balance-display {
        background: linear-gradient(145deg, #2d2d2d, #262626);
        border: 1px solid rgba(247, 147, 26, 0.15);
        text-align: center;
      }

      /* Update the heading style */
      .balance-display h3 {
        text-align: center;
        margin-bottom: 1rem;
      }
    </style>
  </head>
  <body>
    <header style="text-align: center; background: #242424; padding: 1.5rem; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);">
      <h1 style="margin: 0; color: #f7931a;">
        <i class="fa-brands fa-bitcoin fa-icon"></i>
        Bitcoin Trading Game
      </h1>
      <p style="margin: 10px 0 0 0; color: #888;">
        Test your trading skills in a risk-free environment
      </p>
    </header>

    <!-- Add modal HTML -->
    <div id="goal-modal" class="modal">
      <div class="modal-content">
        <h2><i class="fa-solid fa-trophy fa-icon"></i>Congratulations!</h2>
        <p>You've reached your goal of $<span id="goal-amount"></span>! 🎉</p>
        
        <!-- Achievement Card that will be converted to image -->
        <div id="achievement-card" style="background: #2d2d2d; padding: 20px; border-radius: 12px; margin: 20px 0; text-align: center;">
          <img id="achievement-avatar" style="width: 80px; height: 80px; border-radius: 50%; margin-bottom: 10px;" />
          <h3 style="color: #f7931a; margin: 10px 0;"><span id="achievement-name"></span></h3>
          <p style="color: #fff;">Reached $<span id="achievement-amount"></span> in the Bitcoin Trading Game! 🚀</p>
        </div>

        <div style="display: flex; gap: 10px; justify-content: center;">
          <button onclick="shareAchievement()" style="background: #1DA1F2;">
            <i class="fa-brands fa-x-twitter fa-icon"></i>Share on X
          </button>
          <button onclick="startOver()" style="background: #666;">
            <i class="fa-solid fa-rotate-left fa-icon"></i>Start Over
          </button>
        </div>
      </div>
    </div>

    <div id="confirm-modal" class="modal">
      <div class="modal-content">
        <h2>
          <i class="fa-solid fa-triangle-exclamation fa-icon"></i>
          Confirm Start Over
        </h2>
        <p>Are you sure you want to start over? All progress and trading history will be lost.</p>
        <div>
          <button onclick="confirmStartOver()" class="confirm-btn">
            <i class="fa-solid fa-check fa-icon"></i>
            Yes, Start Over
          </button>
          <button onclick="closeConfirmModal()" class="cancel-btn">
            <i class="fa-solid fa-xmark fa-icon"></i>
            Cancel
          </button>
        </div>
      </div>
    </div>

    <div id="welcome-screen">
      <!-- How it works section -->
      <div style="margin-bottom: 60px;">
        <h2 style="text-align: center; color: #f7931a; font-size: 2rem; margin-bottom: 30px;">
          <i class="fa-solid fa-lightbulb fa-icon"></i>
          How It Works
        </h2>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 30px;">
          <div style="background: #2d2d2d; padding: 20px; border-radius: 12px; text-align: center;">
            <i class="fa-solid fa-chart-line fa-3x" style="color: #f7931a; margin-bottom: 15px;"></i>
            <h3>Watch the Market</h3>
            <p style="color: #888;">Monitor real-time Bitcoin price changes and identify trading opportunities</p>
          </div>

          <div style="background: #2d2d2d; padding: 20px; border-radius: 12px; text-align: center;">
            <i class="fa-solid fa-coins fa-3x" style="color: #f7931a; margin-bottom: 15px;"></i>
            <h3>Trade Bitcoin</h3>
            <p style="color: #888;">Buy low and sell high using virtual money - no real risk involved</p>
          </div>

          <div style="background: #2d2d2d; padding: 20px; border-radius: 12px; text-align: center;">
            <i class="fa-solid fa-trophy fa-3x" style="color: #f7931a; margin-bottom: 15px;"></i>
            <h3>Reach Your Goal</h3>
            <p style="color: #888;">Choose your target and try to reach it through smart trading decisions</p>
          </div>
        </div>
      </div>

      <!-- Get Started section with enhanced styling -->
      <div style="background: linear-gradient(145deg, #2d2d2d, #242424); padding: 40px; border-radius: 20px; box-shadow: 0 8px 32px rgba(247, 147, 26, 0.15); margin-bottom: 60px; text-align: center;">
        <h2 style="color: #f7931a; font-size: 2rem; margin-bottom: 30px;">
          <i class="fa-solid fa-rocket fa-icon"></i>
          Get Started
        </h2>
        
        <div style="max-width: 400px; margin: 0 auto;">
          <div id="name-error" class="error-message">Please enter your name to continue</div>
          <input 
            type="text" 
            id="player-name" 
            placeholder="Enter your name" 
            style="font-size: 1.2rem; padding: 15px; width: 100%; margin-bottom: 40px; border: 2px solid rgba(247, 147, 26, 0.3); background: rgba(45, 45, 45, 0.8);" 
          />
        </div>

        <h3 style="color: #f7931a; margin-bottom: 30px; font-size: 1.5rem;">
          <i class="fa-solid fa-trophy fa-icon"></i>
          Choose Your Goal
        </h3>

        <div class="difficulty-section" style="display: flex; gap: 20px; justify-content: center; flex-wrap: wrap;">
          <div class="difficulty-card" style="background: rgba(45, 45, 45, 0.8); padding: 25px; border-radius: 15px; width: 200px; transition: transform 0.2s, box-shadow 0.2s;">
            <div style="margin-bottom: 15px;">
              <i class="fa-solid fa-seedling fa-2x" style="color: #4CAF50;"></i>
              <h4 style="margin: 10px 0;">Beginner</h4>
              <p style="color: #888; font-size: 0.9em;">Start: $40K → Goal: $50K</p>
            </div>
            <button onclick="startGame('50K')" style="width: 100%; padding: 12px; background: #4CAF50;">
              <i class="fa-solid fa-coins fa-icon" style="margin-right: 8px; color: white;"></i>$50K
            </button>
          </div>
          
          <div class="difficulty-card" style="background: rgba(45, 45, 45, 0.8); padding: 25px; border-radius: 15px; width: 200px; transition: transform 0.2s, box-shadow 0.2s;">
            <div style="margin-bottom: 15px;">
              <i class="fa-solid fa-chart-line fa-2x" style="color: #2196F3;"></i>
              <h4 style="margin: 10px 0;">Trader</h4>
              <p style="color: #888; font-size: 0.9em;">Start: $750K → Goal: $1M</p>
            </div>
            <button onclick="startGame('1M')" style="width: 100%; padding: 12px; background: #2196F3;">
              <i class="fa-solid fa-coins fa-icon" style="margin-right: 8px; color: white;"></i>$1M
            </button>
          </div>
          
          <div class="difficulty-card" style="background: rgba(45, 45, 45, 0.8); padding: 25px; border-radius: 15px; width: 200px; transition: transform 0.2s, box-shadow 0.2s;">
            <div style="margin-bottom: 15px;">
              <i class="fa-solid fa-dragon fa-2x" style="color: #F44336;"></i>
              <h4 style="margin: 10px 0;">Expert</h4>
              <p style="color: #888; font-size: 0.9em;">Start: $50M → Goal: $100M</p>
            </div>
            <button onclick="startGame('100M')" style="width: 100%; padding: 12px; background: #F44336;">
              <i class="fa-solid fa-coins fa-icon" style="margin-right: 8px; color: white;"></i>$100M
            </button>
          </div>
        </div>
      </div>
    </div>

    <div id="game-container" class="hidden">
      <div class="welcome-header">
        <img
          id="game-avatar"
          class="player-avatar"
          src=""
          alt="Player Avatar"
        />
        <div class="player-name" id="name-display"></div>
      </div>
      <div class="progress-container">
        <h3><i class="fa-solid fa-bullseye fa-icon"></i>Progress to Goal</h3>
        <div class="progress-bar">
          <div id="progress-fill" class="progress-fill" style="width: 0%"></div>
        </div>
        <div class="progress-text">
          $<span id="current-amount">0</span> / $<span id="goal-display"></span>
        </div>
      </div>
      <div class="balance-display">
        <h3><i class="fa-solid fa-wallet fa-icon"></i>Current Balance</h3>
        <div class="price-display">$<span id="balance-display"></span></div>
      </div>
      <div class="price-holdings-container">
        <div class="balance-display">
          <h3><i class="fa-brands fa-bitcoin fa-icon"></i>Bitcoin Price</h3>
          <div class="price-display">
            $<span id="current-price-display"></span>
          </div>
        </div>
        <div class="balance-display">
          <h3>
            <i class="fa-solid fa-chart-pie fa-icon"></i>Your Bitcoin Holdings
          </h3>
          <div class="price-display"><span id="btc-holdings">0</span> BTC</div>
          <div class="holdings-details">
            <div class="holdings-box">
              <div class="holdings-value">
                <h6 style="margin-bottom: 10px; margin-top: 10px; font-size: 1em">
                  <i class="fa-solid fa-sack-dollar fa-icon"></i>
                  Portfolio Value
                </h6>
                <div>
                  <span style="font-size: 1.2em">
                    $<span id="holdings-value">0</span>
                  </span>
                </div>
              </div>
              <div class="holdings-gain">
                <h6 style="margin-bottom: 10px; margin-top: 10px; font-size: 1em">
                  <i class="fa-solid fa-chart-line fa-icon"></i>
                  Net Profit/Loss
                </h6>
                <div>
                  <span style="font-size: 1.2em">
                    <span id="holdings-gain" class="gain-loss">0</span>
                  </span>
                  </small>
                </div>
              </div>
            </div>
            <script>
              // Add positive/negative class based on value
              const gainLossSpan = document.getElementById("holdings-gain");
              const observer = new MutationObserver(() => {
                const value = parseFloat(
                  gainLossSpan.textContent.replace(/[^-\d.]/g, "")
                );
                gainLossSpan.classList.remove("positive", "negative");
                if (value > 0) gainLossSpan.classList.add("positive");
                if (value < 0) gainLossSpan.classList.add("negative");
              });
              observer.observe(gainLossSpan, { childList: true });
            </script>
          </div>
        </div>
      </div>
      <canvas id="bitcoin-chart"></canvas>

      <div class="trading-controls">
        <div class="trading-section">
          <h3><i class="fa-solid fa-cart-shopping fa-icon"></i>Buy Bitcoin</h3>
          <div class="buy-buttons-grid">
            <button onclick="buyBitcoinPercentage(0.2)" class="buy-button">
              <span class="percentage">20%</span>
              <span class="amount"
                >($<span class="percent-amount" data-percent="0.2">0</span
                >)</span
              >
            </button>
            <button onclick="buyBitcoinPercentage(0.5)" class="buy-button">
              <span class="percentage">50%</span>
              <span class="amount"
                >($<span class="percent-amount" data-percent="0.5">0</span
                >)</span
              >
            </button>
            <button onclick="buyBitcoinPercentage(0.75)" class="buy-button">
              <span class="percentage">75%</span>
              <span class="amount"
                >($<span class="percent-amount" data-percent="0.75">0</span
                >)</span
              >
            </button>
            <button onclick="buyBitcoinPercentage(1)" class="buy-button">
              <span class="percentage">100%</span>
              <span class="amount"
                >($<span class="percent-amount" data-percent="1">0</span>)</span
              >
            </button>
          </div>
        </div>
        <div class="trading-section">
          <h3><i class="fa-solid fa-store fa-icon"></i>Sell Bitcoin</h3>
          <div class="buy-buttons-grid">
            <button
              onclick="sellAllBitcoin()"
              id="sell-button"
              class="buy-button"
            >
              <span class="percentage">Sell All Bitcoins</span>
            </button>
          </div>
        </div>
      </div>

      <div class="history-container">
        <h3>
          <i class="fa-solid fa-clock-rotate-left fa-icon"></i>Trading History
        </h3>
        <table class="history-table">
          <thead>
            <tr>
              <th>Date</th>
              <th>Type</th>
              <th>Amount (BTC)</th>
              <th>Price</th>
              <th>Total (USD)</th>
              <th>Gain/Loss</th>
            </tr>
          </thead>
          <tbody id="history-tbody"></tbody>
        </table>
      </div>

      <button id="start-over-btn" onclick="startOver()">
        <i class="fa-solid fa-rotate-left fa-icon"></i>Start Over
      </button>
    </div>

    <footer style="text-align: center; background: #242424; padding: 1.5rem; border-radius: 12px; margin-top: 2rem; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);">
      <div style="display: flex; justify-content: center; gap: 20px; margin-bottom: 10px;">
        <a href="https://twitter.com/manuelalferez" target="_blank" style="color: #1DA1F2; text-decoration: none; display: flex; align-items: center; gap: 5px;">
          <i class="fa-brands fa-x-twitter"></i>
          @manuelalferez
        </a>
        <a href="https://manuelalferez.com" target="_blank" style="color: #f7931a; text-decoration: none; display: flex; align-items: center; gap: 5px;">
          <i class="fas fa-globe"></i>
          manuelalferez.com
        </a>
      </div>
      <div style="color: #888; font-size: 0.9rem;">
        © 2024 Bitcoin Trading Game. All rights reserved.
      </div>
    </footer>

    <script>
      let playerName, goal, balance;
      let priceHistory = [];
      let chart;
      let bitcoinHoldings = 0;
      let totalInvested = 0;
      let tradingHistory = [];
      const TOTAL_POINTS = 120; // 60 seconds before and after
      const UPDATE_INTERVAL = 1000; // Update every second

      function showModal(modalId) {
        document.getElementById(modalId).style.display = 'flex';
      }

      function closeModal(modalId) {
        document.getElementById(modalId).style.display = 'none';
      }

      function startOver() {
        // If it's from the goal modal, just go back to welcome screen and clear cookies
        if (document.getElementById('goal-modal').style.display === 'flex') {
          closeModal('goal-modal');
          clearAllCookies();
          document.getElementById('welcome-screen').classList.remove('hidden');
          document.getElementById('game-container').classList.add('hidden');
          document.getElementById('player-name').value = '';
          return;
        }
        
        // Otherwise, show the confirmation modal
        showModal('confirm-modal');
      }

      function closeConfirmModal() {
        closeModal('confirm-modal');
      }

      function confirmStartOver() {
        clearAllCookies();
        
        // Reset the game
        document.getElementById('welcome-screen').classList.remove('hidden');
        document.getElementById('game-container').classList.add('hidden');
        document.getElementById('player-name').value = '';
        
        // Close the confirmation modal
        closeModal('confirm-modal');
        
        // Destroy chart if it exists
        if (chart) {
          chart.destroy();
          chart = null;
        }
      }

      function shareOnTwitter() {
        const text = `I just reached my goal of $${goal} in the Bitcoin Trading Game! 🎉 Can you beat my score?`;
        window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}`);
      }

      function shareOnFacebook() {
        const url = window.location.href;
        window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}`);
      }

      function shareOnLinkedIn() {
        const url = window.location.href;
        const title = 'Bitcoin Trading Game Achievement';
        const summary = `I just reached my goal of $${goal} in the Bitcoin Trading Game! 🎉`;
        window.open(`https://www.linkedin.com/shareArticle?mini=true&url=${encodeURIComponent(url)}&title=${encodeURIComponent(title)}&summary=${encodeURIComponent(summary)}`);
      }

      // Load data from cookies
      function loadFromCookies() {
        playerName = getCookie("playerName") || "";
        goal = getCookie("goal") || "";
        balance = parseFloat(getCookie("balance")) || 0;
        bitcoinHoldings = parseFloat(getCookie("bitcoinHoldings")) || 0;
        totalInvested = parseFloat(getCookie("totalInvested")) || 0;
        tradingHistory = JSON.parse(getCookie("tradingHistory") || "[]");
        
        // Load the new values
        const lastBitcoinPrice = parseFloat(getCookie("lastBitcoinPrice")) || 0;
        if (lastBitcoinPrice) {
          document.getElementById("current-price-display").textContent = lastBitcoinPrice.toLocaleString();
        }
        
        const portfolioValue = parseFloat(getCookie("portfolioValue")) || 0;
        if (portfolioValue) {
          document.getElementById("holdings-value").textContent = portfolioValue.toFixed(2);
        }
        
        const netProfitLoss = parseFloat(getCookie("netProfitLoss")) || 0;
        if (netProfitLoss) {
          const gainLossSpan = document.getElementById("holdings-gain");
          gainLossSpan.textContent = "$" + (netProfitLoss >= 0 ? "+" : "") + netProfitLoss.toFixed(2);
          gainLossSpan.classList.remove("positive", "negative");
          if (netProfitLoss > 0) gainLossSpan.classList.add("positive");
          if (netProfitLoss < 0) gainLossSpan.classList.add("negative");
        }

        // Convert date strings back to Date objects in trading history
        tradingHistory = tradingHistory.map((t) => ({
          ...t,
          date: new Date(t.date),
        }));
      }

      // Save data to cookies
      function saveToCookies() {
        setCookie("playerName", playerName, 30);
        setCookie("goal", goal, 30);
        setCookie("balance", balance.toString(), 30);
        setCookie("bitcoinHoldings", bitcoinHoldings.toString(), 30);
        setCookie("totalInvested", totalInvested.toString(), 30);
        setCookie("tradingHistory", JSON.stringify(tradingHistory), 30);
        
        // Save the new values
        const currentPrice = parseFloat(document.getElementById("current-price-display").textContent.replace(/,/g, ""));
        setCookie("lastBitcoinPrice", currentPrice.toString(), 30);
        
        const portfolioValue = parseFloat(document.getElementById("holdings-value").textContent);
        setCookie("portfolioValue", portfolioValue.toString(), 30);
        
        const netProfitLoss = parseFloat(document.getElementById("holdings-gain").textContent.replace(/[^-\d.]/g, ""));
        setCookie("netProfitLoss", netProfitLoss.toString(), 30);
      }

      // Cookie helper functions
      function setCookie(name, value, days) {
        const d = new Date();
        d.setTime(d.getTime() + days * 24 * 60 * 60 * 1000);
        const expires = "expires=" + d.toUTCString();
        document.cookie = name + "=" + value + ";" + expires + ";path=/";
      }

      function getCookie(name) {
        const value = `; ${document.cookie}`;
        const parts = value.split(`; ${name}=`);
        if (parts.length === 2) return parts.pop().split(";").shift();
      }

      // Wait for DOM to be fully loaded
      document.addEventListener("DOMContentLoaded", () => {
        loadFromCookies();

        // If we have saved data, restore the game
        if (playerName && goal) {
          document.getElementById("player-name").value = playerName;
          document.getElementById("welcome-screen").classList.add("hidden");
          document.getElementById("game-container").classList.remove("hidden");
          document.getElementById("name-display").textContent = playerName;
          document.getElementById("goal-display").textContent = goal;
          document.getElementById("balance-display").textContent =
            balance.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});
          document.getElementById(
            "game-avatar"
          ).src = `https://api.dicebear.com/9.x/adventurer/svg?seed=${playerName}`;

          updateDisplays();
          updateHistoryDisplay();
          initializeChart();
          startBitcoinSimulation();
        }
      });

      function startGame(selectedGoal) {
        const nameInput = document.getElementById("player-name");
        const errorMessage = document.getElementById("name-error");
        
        if (!nameInput.value.trim()) {
          nameInput.classList.add("input-error");
          errorMessage.style.display = "block";
          
          setTimeout(() => {
            nameInput.classList.remove("input-error");
          }, 500);
          
          return;
        }
        
        nameInput.classList.remove("input-error");
        errorMessage.style.display = "none";
        
        clearAllCookies();
        
        window.scrollTo({ top: 0, behavior: 'smooth' });
        
        playerName = nameInput.value;
        goal = selectedGoal;
        switch (selectedGoal) {
          case "50K":
            balance = 40000; // Beginner: Start with 40K, goal is 50K
            break;
          case "1M":
            balance = 750000; // Trader: Start with 750K, goal is 1M
            break;
          case "100M":
            balance = 50000000; // Expert: Start with 50M, goal is 100M
            break;
        }

        document.getElementById("welcome-screen").classList.add("hidden");
        document.getElementById("game-container").classList.remove("hidden");
        document.getElementById("name-display").textContent = playerName;
        document.getElementById("goal-display").textContent = selectedGoal;
        document.getElementById("balance-display").textContent =
          balance.toLocaleString();
        document.getElementById(
          "game-avatar"
        ).src = `https://api.dicebear.com/9.x/adventurer/svg?seed=${playerName}`;

        // Reset displays
        document.getElementById("current-price-display").textContent = "0";
        document.getElementById("holdings-value").textContent = "0.00";
        document.getElementById("holdings-gain").textContent = "$0.00";
        document.getElementById("btc-holdings").textContent = "0.0000";

        updateProgress();
        saveToCookies();

        initializeChart();
        startBitcoinSimulation();
      }

      function updateProgress() {
        const goalAmount = parseInt(
          goal.replace("K", "000").replace("M", "000000")
        );
        const progress = (balance / goalAmount) * 100;
        document.getElementById("progress-fill").style.width =
          Math.min(100, progress) + "%";
        document.getElementById("current-amount").textContent =
          balance.toLocaleString();
      }

      function addToHistory(type, btcAmount, price, total, gain = null) {
        const transaction = {
          date: new Date(),
          type,
          btcAmount,
          price,
          total,
          gain,
        };
        tradingHistory.unshift(transaction);
        updateHistoryDisplay();
        saveToCookies();
      }

      function updateHistoryDisplay() {
        const tbody = document.getElementById("history-tbody");
        tbody.innerHTML = "";

        tradingHistory.forEach((transaction) => {
          const row = document.createElement("tr");
          const gainClass =
            transaction.gain > 0
              ? "gain-positive"
              : transaction.gain < 0
              ? "gain-negative"
              : "";

          row.innerHTML = `
            <td>${transaction.date.toLocaleString()}</td>
            <td>${transaction.type}</td>
            <td>${transaction.btcAmount.toFixed(4)}</td>
            <td>$${transaction.price.toLocaleString()}</td>
            <td>$${transaction.total.toLocaleString()}</td>
            <td class="${gainClass}">${
            transaction.gain !== null
              ? (transaction.gain > 0 ? "+" : "") +
                "$" +
                transaction.gain.toLocaleString()
              : "-"
          }</td>`;
          tbody.appendChild(row);
        });
      }

      function updatePercentageAmounts() {
        document.querySelectorAll(".percent-amount").forEach((span) => {
          const percent = parseFloat(span.dataset.percent);
          const amount = balance * percent;
          span.textContent = amount.toLocaleString();
        });
      }

      function buyBitcoinPercentage(percentage) {
        const usdAmount = balance * percentage;
        const currentPrice = parseFloat(
          document
            .getElementById("current-price-display")
            .textContent.replace(/,/g, "")
        );

        const btcAmount = usdAmount / currentPrice;
        balance -= usdAmount;
        bitcoinHoldings += btcAmount;
        totalInvested += usdAmount;

        addToHistory("BUY", btcAmount, currentPrice, usdAmount);
        updateDisplays();
        saveToCookies();
      }

      function sellAllBitcoin() {
        if (bitcoinHoldings <= 0) {
          alert("You don't have any Bitcoin to sell!");
          return;
        }

        const currentPrice = parseFloat(
          document
            .getElementById("current-price-display")
            .textContent.replace(/,/g, "")
        );
        const totalValue = bitcoinHoldings * currentPrice;
        const gain = totalValue - totalInvested;
        balance += totalValue;

        addToHistory("SELL", bitcoinHoldings, currentPrice, totalValue, gain);

        bitcoinHoldings = 0;
        totalInvested = 0;
        updateDisplays();
        saveToCookies();
      }

      function updateDisplays() {
        const currentPrice = parseFloat(
          document
            .getElementById("current-price-display")
            .textContent.replace(/,/g, "")
        );
        const holdingsValue = bitcoinHoldings * currentPrice;
        const gainLoss = holdingsValue - totalInvested;

        document.getElementById("balance-display").textContent =
          balance.toLocaleString();
        document.getElementById("btc-holdings").textContent =
          bitcoinHoldings.toFixed(4);
        document.getElementById("holdings-value").textContent =
          holdingsValue.toFixed(2);
        document.getElementById("holdings-gain").textContent =
          "$" + (gainLoss >= 0 ? "+" : "") + gainLoss.toFixed(2);
        document.getElementById("sell-button").disabled = bitcoinHoldings <= 0;
        updateProgress();
        updatePercentageAmounts();
        saveToCookies();
      }

      function initializeChart() {
        const ctx = document.getElementById("bitcoin-chart").getContext("2d");
        priceHistory = new Array(TOTAL_POINTS).fill(null);

        chart = new Chart(ctx, {
          type: "line",
          data: {
            labels: [],
            datasets: [
              {
                label: "Bitcoin Price",
                data: priceHistory,
                borderColor: "#f7931a",
                backgroundColor: "rgba(247, 147, 26, 0.1)",
                tension: 0.4,
                fill: true,
                spanGaps: true,
              },
            ],
          },
          options: {
            responsive: true,
            plugins: {
              legend: {
                labels: {
                  color: "#fff",
                },
              },
            },
            scales: {
              y: {
                beginAtZero: false,
                grid: {
                  color: "#333",
                },
                ticks: {
                  color: "#fff",
                },
              },
              x: {
                grid: {
                  color: "#333",
                },
                ticks: {
                  color: "#fff",
                  callback: function (value) {
                    if (value === 60) return "Now";
                    const offset = value - 60;
                    return offset > 0 ? `+${offset}s` : `${offset}s`;
                  },
                },
              },
            },
          },
        });
      }

      async function getBitcoinPrice() {
        try {
          const response = await fetch(
            "https://api.binance.com/api/v3/ticker/price?symbol=BTCUSDT"
          );
          const data = await response.json();
          return parseFloat(data.price);
        } catch (error) {
          console.error("Error fetching Bitcoin price:", error);
          return null;
        }
      }

      async function startBitcoinSimulation() {
        let currentPrice = (await getBitcoinPrice()) || 30000;
        document.getElementById("current-price-display").textContent =
          currentPrice.toLocaleString();

        priceHistory[60] = currentPrice;

        setInterval(async () => {
          const newPrice = await getBitcoinPrice();
          if (newPrice) {
            currentPrice = newPrice;
            document.getElementById("current-price-display").textContent =
              currentPrice.toLocaleString();

            priceHistory.shift();
            priceHistory.push(null);
            priceHistory[60] = currentPrice;

            chart.data.labels = Array.from(
              { length: TOTAL_POINTS },
              (_, i) => i
            );
            chart.data.datasets[0].data = priceHistory;
            chart.update();

            updateDisplays();

            const goalAmount = parseInt(goal.replace("K", "000").replace("M", "000000"));
            if (balance >= goalAmount) {
              document.getElementById('goal-amount').textContent = goalAmount.toLocaleString();
              document.getElementById('achievement-avatar').src = document.getElementById('game-avatar').src;
              document.getElementById('achievement-name').textContent = playerName;
              document.getElementById('achievement-amount').textContent = goal.replace('K', ',000').replace('M', ',000,000');
              
              showModal('goal-modal');
            }
          }
        }, UPDATE_INTERVAL);
      }

      // Add this to clear error state when user starts typing
      document.getElementById("player-name").addEventListener("input", function() {
        this.classList.remove("input-error");
        document.getElementById("name-error").style.display = "none";
      });

      async function generateAchievementImage() {
        // Update achievement card content
        document.getElementById('achievement-avatar').src = document.getElementById('game-avatar').src;
        document.getElementById('achievement-name').textContent = playerName;
        document.getElementById('achievement-amount').textContent = goal.replace('K', ',000').replace('M', ',000,000');

        try {
          // Convert the achievement card to canvas using html2canvas
          const canvas = await html2canvas(document.getElementById('achievement-card'));
          return canvas.toDataURL('image/png');
        } catch (error) {
          console.error('Error generating image:', error);
          return null;
        }
      }

      async function shareAchievement() {
        const imageData = await generateAchievementImage();
        if (!imageData) {
          // Fallback to text-only tweet if image generation fails
          const text = `I just reached my goal of $${goal} in the Bitcoin Trading Game! 🎉 Can you beat my score?`;
          window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}`);
          return;
        }

        // Open Twitter share dialog
        const text = `I just reached my goal of $${goal} in the Bitcoin Trading Game! 🎉 Can you beat my score?`;
        window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}`);
      }

      // Add this new helper function to clear all cookies
      function clearAllCookies() {
        const cookiesToClear = [
          "playerName", "goal", "balance", "bitcoinHoldings", "totalInvested", 
          "tradingHistory", "lastBitcoinPrice", "portfolioValue", "netProfitLoss"
        ];
        
        cookiesToClear.forEach(cookieName => {
          document.cookie = `${cookieName}=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/`;
        });

        // Reset game variables
        playerName = "";
        goal = "";
        balance = 0;
        bitcoinHoldings = 0;
        totalInvested = 0;
        tradingHistory = [];
        priceHistory = [];

        // Clear the trading history table
        const tbody = document.getElementById("history-tbody");
        if (tbody) {
          tbody.innerHTML = "";
        }
      }
    </script>
  </body>
</html>
